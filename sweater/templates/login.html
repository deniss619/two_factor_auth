<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login</title>
    <link rel="shortcut icon" href="./static/logo.jpg" type="image/jpg">
    <link rel="stylesheet" type="text/css" href="{{url_for('static',filename='styles.css')}}" >
</head>
<body>
<h1>login page</h1>
{% with messages = get_flashed_messages() %}
    {% if messages %}
        <ul class="flashes">
        {% for message in messages %}
            <li>{{message }}</li>
        {% endfor %}
        </ul>
    {% endif %}
{% endwith %}
<div>
    <p id="errorMessage" class="hidden">Ошибка в логине или пароле</p>
</div>
<form method="POST" action="firstFactor" id="form">
    <table>
        <tr>
            <td>Логин</td>
            <td><input type="text" name="login" id="login"></td>
        </tr>
        <tr>
            <td>Пароль</td>
            <td><input type="password" name="password" id="password"></td>
        </tr>
        <tr>
            <td><input type="submit" value="Login"></td>
            <td><a href="{{url_for('register')}}">Register</a> </td>
        </tr>
        <tr>
            <td><input id="coordinateOfClick" type="hidden" name="coordinateOfClick"></td>
        </tr>
    </table>
</form>
<button onclick="checkLoginPassword()">Send</button>
<div id="containerForLogin" >
    <img id="loginImg">
</div>

<!--<div id="zatemnenie">-->
<!--    <div id="okno" onclick = 'document.getElementById("form").submit();'>-->
<!--&lt;!&ndash;        <form id = "myform" action="./index" method = "post" style = "display:none;">&ndash;&gt;-->
<!--&lt;!&ndash;            <input id="coordinateOfClick" type="hidden" name="coordinateOfClick">&ndash;&gt;-->
<!--&lt;!&ndash;        </form>&ndash;&gt;-->
<!--        <div id="containerForLogin">-->
<!--            <img id="loginImg">-->
<!--        </div>-->
<!--        <div onclick = 'document.getElementById("form").submit();'></div>-->
<!--            <a href="#" class="close">Закрыть окно</a>-->
<!--    </div>-->
<!--</div>-->
<script>
var ajax = new XMLHttpRequest();
ajax.onreadystatechange = function() {
    var errorMark=0;
    if (ajax.readyState == 4) {
        if (ajax.status == 200) {
            if(ajax.responseText=="success"){
                location="success";
        	}
	        else if(ajax.responseText.slice(0,15)=="<!DOCTYPE html>"){
	            location="firstFactor";
	        }
	        else if(ajax.responseText=='error'){
	            document.getElementById("errorMessage").className='';
	        }
	        else{
	            <!--            window.location.href = '#zatemnenie';-->
    <!--            alert(ajax.getResponseHeader("content-type"))-->
                document.getElementById("loginImg").src="data:image/png;base64,"+ajax.responseText;
                document.getElementById("errorMessage").className='hidden';
            }
    	}
	}
}


function checkLoginPassword(){
    params='login=' + document.getElementById('login').value + '&password=' + document.getElementById('password').value;
    ajax.open('POST', 'firstFactor');
    ajax.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    ajax.send(params);

}
function printMousePos(event) {
    console.log("clientX: " + event.offsetX + " - clientY: " + event.offsetY);
    mass=[event.offsetX,event.offsetY]
    params='login=' + document.getElementById('login').value + '&password=' + document.getElementById('password').value + '&coordinate=' + mass.join();
<!--    document.getElementById('coordinateOfClick').setAttribute('value', mass.join());-->
    ajax.open('POST', 'firstFactor');
    ajax.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    ajax.send(params);

}

document.getElementById("containerForLogin").addEventListener("click", printMousePos);
</script>
<style>
  #zatemnenie {
    background: rgba(102, 102, 102, 0.5);
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
    display: none;
  }
  #okno {
    width: 600px;
    height: 600px;
    text-align: center;
    padding: 15px;
    border: 3px solid #0000cc;
    border-radius: 10px;
    color: #0000cc;
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    margin: auto;
    background: #fff;
  }
  #zatemnenie:target {display: block;}
  .close {
    display: inline-block;
    border: 1px solid #0000cc;
    color: #0000cc;
    padding: 0 12px;
    margin: 10px;
    text-decoration: none;
    background: #f2f2f2;
    font-size: 14pt;
    cursor:pointer;
  }
  .close:hover {background: #e6e6ff;}
</style>
</body>
</html>